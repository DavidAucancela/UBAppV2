<div class="reset-password-container">
  <div class="reset-card">
    <!-- Paso 1: Solicitar restablecimiento -->
    <div class="reset-step" *ngIf="step === 'request'">
      <div class="header">
        <div class="icon">
          <i class="fas fa-lock"></i>
        </div>
        <h2>¿Olvidaste tu contraseña?</h2>
        <p>No te preocupes, te enviaremos instrucciones para restablecerla.</p>
      </div>

      <form [formGroup]="requestForm" (ngSubmit)="requestReset()" class="reset-form">
        <div class="form-group">
          <label for="email">Correo Electrónico</label>
          <div class="input-group">
            <span class="input-icon">
              <i class="fas fa-envelope"></i>
            </span>
            <input 
              type="email" 
              id="email"
              formControlName="email" 
              class="form-control"
              placeholder="tu-correo@ejemplo.com"
              [class.error]="requestForm.get('email')?.invalid && requestForm.get('email')?.touched"
            >
          </div>
          <div class="error-message" *ngIf="requestForm.get('email')?.invalid && requestForm.get('email')?.touched">
            Por favor ingresa un correo electrónico válido
          </div>
        </div>

        <button 
          type="submit" 
          class="btn btn-primary btn-block"
          [disabled]="!requestForm.valid || submitting"
        >
          <i class="fas fa-spinner fa-spin" *ngIf="submitting"></i>
          <i class="fas fa-paper-plane" *ngIf="!submitting"></i>
          {{ submitting ? 'Enviando...' : 'Enviar instrucciones' }}
        </button>
      </form>

      <div class="success-message" *ngIf="successMessage">
        <i class="fas fa-check-circle"></i>
        {{ successMessage }}
      </div>

      <div class="error-alert" *ngIf="errorMessage">
        <i class="fas fa-exclamation-triangle"></i>
        {{ errorMessage }}
      </div>

      <div class="footer-links">
        <a routerLink="/login" class="link">
          <i class="fas fa-arrow-left"></i>
          Volver al login
        </a>
        <span class="separator">|</span>
        <a routerLink="/register" class="link">
          ¿No tienes cuenta? Regístrate
        </a>
      </div>
    </div>

    <!-- Paso 2: Nueva contraseña -->
    <div class="reset-step" *ngIf="step === 'reset'">
      <div class="header">
        <div class="icon">
          <i class="fas fa-key"></i>
        </div>
        <h2>Crear nueva contraseña</h2>
        <p>Tu nueva contraseña debe ser diferente a las contraseñas anteriores.</p>
      </div>

      <form [formGroup]="resetForm" (ngSubmit)="resetPassword()" class="reset-form">
        <div class="form-group">
          <label for="new_password">Nueva Contraseña</label>
          <div class="password-input">
            <span class="input-icon">
              <i class="fas fa-lock"></i>
            </span>
            <input 
              [type]="hidePassword ? 'password' : 'text'"
              id="new_password"
              formControlName="new_password" 
              class="form-control"
              placeholder="Ingresa tu nueva contraseña"
              [class.error]="resetForm.get('new_password')?.invalid && resetForm.get('new_password')?.touched"
            >
            <button 
              type="button" 
              class="password-toggle"
              (click)="hidePassword = !hidePassword"
            >
              <i class="fas" [class.fa-eye]="!hidePassword" [class.fa-eye-slash]="hidePassword"></i>
            </button>
          </div>
          
          <!-- Indicador de fuerza de contraseña -->
          <div class="password-strength" *ngIf="resetForm.get('new_password')?.value">
            <h4>La contraseña debe tener:</h4>
            <ul>
              <li [class.valid]="passwordStrength.hasMinLength">
                <i class="fas" [class.fa-check]="passwordStrength.hasMinLength" 
                   [class.fa-times]="!passwordStrength.hasMinLength"></i>
                Mínimo 8 caracteres
              </li>
              <li [class.valid]="passwordStrength.hasUpperCase">
                <i class="fas" [class.fa-check]="passwordStrength.hasUpperCase" 
                   [class.fa-times]="!passwordStrength.hasUpperCase"></i>
                Una letra mayúscula
              </li>
              <li [class.valid]="passwordStrength.hasLowerCase">
                <i class="fas" [class.fa-check]="passwordStrength.hasLowerCase" 
                   [class.fa-times]="!passwordStrength.hasLowerCase"></i>
                Una letra minúscula
              </li>
              <li [class.valid]="passwordStrength.hasNumber">
                <i class="fas" [class.fa-check]="passwordStrength.hasNumber" 
                   [class.fa-times]="!passwordStrength.hasNumber"></i>
                Un número
              </li>
              <li [class.valid]="passwordStrength.hasSpecial">
                <i class="fas" [class.fa-check]="passwordStrength.hasSpecial" 
                   [class.fa-times]="!passwordStrength.hasSpecial"></i>
                Un carácter especial (!@#$%^&*)
              </li>
            </ul>
          </div>
        </div>

        <div class="form-group">
          <label for="confirm_password">Confirmar Contraseña</label>
          <div class="password-input">
            <span class="input-icon">
              <i class="fas fa-lock"></i>
            </span>
            <input 
              [type]="hidePasswordConfirm ? 'password' : 'text'"
              id="confirm_password"
              formControlName="confirm_password" 
              class="form-control"
              placeholder="Confirma tu nueva contraseña"
              [class.error]="resetForm.get('confirm_password')?.invalid && resetForm.get('confirm_password')?.touched"
            >
            <button 
              type="button" 
              class="password-toggle"
              (click)="hidePasswordConfirm = !hidePasswordConfirm"
            >
              <i class="fas" [class.fa-eye]="!hidePasswordConfirm" [class.fa-eye-slash]="hidePasswordConfirm"></i>
            </button>
          </div>
          <div class="error-message" *ngIf="resetForm.get('confirm_password')?.hasError('passwordMismatch') && resetForm.get('confirm_password')?.touched">
            Las contraseñas no coinciden
          </div>
        </div>

        <button 
          type="submit" 
          class="btn btn-primary btn-block"
          [disabled]="!resetForm.valid || !passwordStrength.isValid || submitting"
        >
          <i class="fas fa-spinner fa-spin" *ngIf="submitting"></i>
          <i class="fas fa-save" *ngIf="!submitting"></i>
          {{ submitting ? 'Restableciendo...' : 'Restablecer contraseña' }}
        </button>
      </form>

      <div class="error-alert" *ngIf="errorMessage">
        <i class="fas fa-exclamation-triangle"></i>
        {{ errorMessage }}
      </div>

      <div class="footer-links">
        <a routerLink="/login" class="link">
          <i class="fas fa-arrow-left"></i>
          Volver al login
        </a>
      </div>
    </div>

    <!-- Paso 3: Éxito -->
    <div class="reset-step success" *ngIf="step === 'success'">
      <div class="header">
        <div class="icon success-icon">
          <i class="fas fa-check-circle"></i>
        </div>
        <h2>¡Contraseña restablecida!</h2>
        <p>Tu contraseña ha sido cambiada exitosamente.</p>
        <p class="redirect-message">Serás redirigido al login en unos segundos...</p>
      </div>

      <a routerLink="/login" class="btn btn-primary btn-block">
        Ir al Login ahora
      </a>
    </div>
  </div>
</div>












