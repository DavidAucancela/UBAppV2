<header class="animated-header" *ngIf="!shouldHideNavbar">  <!-- Barra de Navegación -->
  <div class="header-content" [@navbarSlide]="navbarState">
    <!-- Logo con animación - Siempre visible -->
    <a class="logo" [routerLink]="authService.isAuthenticated() ? (authService.isComprador() ? '/dashboard-usuario' : '/inicio') : '/informacion'" 
       [routerLinkActive]="'active'" 
       aria-label="Ir al inicio de UBApp"
       (click)="handleLogoClick($event)"
       [@logoAnimation]="logoState">
      <i class="fas fa-shipping-fast"
         aria-hidden="true"
         title="Mantén presionado 5 segundos para alternar el tema"
         (pointerdown)="handleLogoPressStart($event)"
         (pointerup)="handleLogoPressEnd($event)"
         (pointerleave)="handleLogoPressEnd($event)"
         (pointercancel)="handleLogoPressEnd($event)"></i>
      <span>UBApp</span>
      <div class="logo-glow"></div>
    </a>
    
    <!-- Menú de Navegación - Solo si está autenticado -->
    <nav class="nav-menu" aria-label="Navegación principal" *ngIf="authService.isAuthenticated()">
      <ul class="nav-list">
        <li class="nav-item" *ngFor="let item of visibleNavItems; let i = index" 
            [@itemAnimation]="getAnimationDelay(i)"
            [class.expanded]="isExpanded(item.label)">
          <!-- Item principal -->
          <a *ngIf="!item.subItems || item.subItems.length === 0"
             [routerLink]="item.route" 
             routerLinkActive="active"
             class="nav-link"
             (click)="handleNavLinkClick(item, $event)"
             aria-current="page">
            <i [class]="item.icon" aria-hidden="true"></i>
            <span>{{ item.label }}</span>
          </a>
          <a *ngIf="item.subItems && item.subItems.length > 0"
             class="nav-link has-submenu no-navigate"
             (click)="handleItemClick(item, $event)"
             aria-current="page">
            <i [class]="item.icon" aria-hidden="true"></i>
            <span>{{ item.label }}</span>
            <i class="fas fa-chevron-down submenu-arrow" 
               [class.rotated]="isExpanded(item.label)"
               aria-hidden="true"></i>
          </a>
          
          <!-- Submenú mejorado con animación -->
          <ul class="dropdown-menu" 
              *ngIf="item.subItems && item.subItems.length > 0 && isExpanded(item.label)">
            <li *ngFor="let subItem of item.subItems">
              <a [routerLink]="subItem.route" 
                 routerLinkActive="active"
                 class="dropdown-item"
                 (click)="toggleSubmenu(item.label)">
                <i [class]="subItem.icon" aria-hidden="true"></i>
                <span>{{ subItem.label }}</span>
              </a>
            </li>
          </ul>
        </li>
      </ul>
      
      <!-- Indicador de carga -->
      <div class="nav-loading" *ngIf="isLoadingNav">
        <div class="loading-dots">
          <span></span>
          <span></span>
          <span></span>
        </div>
      </div>
    </nav>
    
    <!-- Botones públicos cuando NO está autenticado -->
    <div class="public-actions" *ngIf="!authService.isAuthenticated()">
      <!--<a routerLink="/informacion" routerLinkActive="active" class="nav-link-public">
        <i class="fas fa-info-circle"></i>
        <span>Información</span>
      </a>
      <a routerLink="/ubicaciones" routerLinkActive="active" class="nav-link-public">
        <i class="fas fa-map-marked-alt"></i>
        <span>Ubicaciones</span>
      </a>-->
      <a routerLink="/register" class="btn-register">
        <i class="fas fa-user-plus me-2"></i>
        <span>Crear cuenta</span>
      </a>
      <a routerLink="/login" class="btn-login">
        <i class="fas fa-sign-in-alt me-2"></i>
        <span>Iniciar Sesión</span>
      </a>
    </div>
    
    <!-- Acciones del Header con animación - Solo si está autenticado -->
    <div class="header-actions" [@actionsAnimation]="actionsState" *ngIf="authService.isAuthenticated()">
      <!-- Notificaciones - Solo para Compradores -->
      <div class="notification-wrapper" *ngIf="isComprador()">
        <button 
          class="action-btn" 
          title="Notificaciones" 
          aria-label="Ver notificaciones"
          (click)="toggleNotificacionesDropdown()"
          [class.has-notifications]="notificacionCount.no_leidas > 0">
          <i class="fas fa-bell" aria-hidden="true"></i>
          <span class="badge" *ngIf="notificacionCount.no_leidas > 0">
            {{ notificacionCount.no_leidas > 99 ? '99+' : notificacionCount.no_leidas }}
          </span>
          <span class="pulse-ring" *ngIf="notificacionCount.no_leidas > 0"></span>
        </button>

        <!-- Dropdown de Notificaciones -->
        <div class="notificaciones-dropdown" *ngIf="showNotificacionesDropdown" (click)="$event.stopPropagation()">
          <div class="dropdown-header">
            <h4>Notificaciones</h4>
            <button 
              *ngIf="notificacionCount.no_leidas > 0"
              class="btn-marcar-todas"
              (click)="marcarTodasLeidas()"
              title="Marcar todas como leídas">
              Marcar todas como leídas
            </button>
          </div>

          <div class="notificaciones-list">
            <div 
              *ngFor="let notificacion of notificaciones" 
              class="notificacion-item"
              [class.leida]="notificacion.leida"
              (click)="marcarNotificacionLeida(notificacion, $event)">
              <div class="notificacion-icon">
                <i 
                  [class]="getNotificacionIcon(notificacion.tipo)"
                  [class.fa-circle]="!notificacion.leida">
                </i>
              </div>
              <div class="notificacion-content">
                <h5>{{ notificacion.titulo }}</h5>
                <p>{{ notificacion.mensaje }}</p>
                <span class="notificacion-time">{{ getTimeAgo(notificacion.fecha_creacion) }}</span>
              </div>
            </div>

            <div class="no-notificaciones" *ngIf="notificaciones.length === 0">
              <i class="fas fa-bell-slash"></i>
              <p>No tienes notificaciones</p>
            </div>
          </div>

          <div class="dropdown-footer" *ngIf="notificaciones.length > 0">
            <a routerLink="/notificaciones" (click)="closeNotificacionesDropdown()">
              Ver todas las notificaciones
            </a>
          </div>
        </div>
      </div>
      
      <!-- Modal de Detalles de Envío -->
      <app-envio-detail-modal
        [envioId]="selectedEnvioId"
        [show]="showEnvioDetailModal"
        (close)="closeEnvioDetailModal()">
      </app-envio-detail-modal>
      
      <!-- Búsqueda rápida 
      <button class="action-btn" title="Búsqueda rápida" aria-label="Abrir búsqueda rápida">
        <i class="fas fa-search" aria-hidden="true"></i>
      </button>-->
      
      <!-- Menú de Usuario -->
      <div class="user-menu">
        <button class="user-info" 
                (click)="toggleUserMenu()" 
                [attr.aria-expanded]="showUserMenu" 
                aria-label="Menú de usuario"
                title="Usuario Actual">
          <div class="user-avatar">
            <i class="fas fa-user-circle" aria-hidden="true"></i>
            <div class="status-indicator online"></div>
          </div>
          <div class="user-details" *ngIf="currentUser">
            <span class="user-name">{{ currentUser.nombre }}</span>
            <span class="user-role">{{ getRoleLabel(currentUser.rol) }}</span>
          </div>
          <i class="fas fa-chevron-down" aria-hidden="true"></i>
        </button>
        
        <!-- Dropdown del usuario -->
        <div class="user-dropdown" *ngIf="showUserMenu" (click)="$event.stopPropagation()">
          <div class="dropdown-header">
            <div class="user-avatar-large">
              <i class="fas fa-user-circle"></i>
            </div>
            <div class="user-info-text" *ngIf="currentUser">
              <h4>{{ currentUser.nombre }}</h4>
              <p>{{ currentUser.correo }}</p>
              <span class="role-badge">{{ getRoleLabel(currentUser.rol) }}</span>
            </div>
          </div>
          
          <div class="dropdown-divider"></div>
          
          <a routerLink="/perfil" class="dropdown-item" (click)="closeUserMenu()">
            <i class="fas fa-user"></i>
            <span>Mi Perfil</span>
          </a>
          <div class="dropdown-divider"></div>
          
          <button class="dropdown-item logout-btn" (click)="logout()">
            <i class="fas fa-sign-out-alt"></i>
            <span>Cerrar Sesión</span>
          </button>
        </div>
      </div>
    </div>
  </div>
</header>
