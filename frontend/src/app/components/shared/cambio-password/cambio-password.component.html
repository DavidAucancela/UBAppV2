<div class="cambio-password-container">
  <div class="password-section-header">
    <h4 class="section-title">
      <i class="fas fa-lock"></i>
      {{ showCurrentPassword ? 'Cambiar Contraseña' : 'Contraseña' }}
    </h4>
  </div>

  <form [formGroup]="passwordForm">
    <!-- Contraseña Actual (solo si showCurrentPassword es true) -->
    <div class="form-group" *ngIf="showCurrentPassword">
    <label for="currentPassword" class="form-label">
      <i class="fas fa-key"></i>
      {{ currentPasswordLabel }} <span class="required">*</span>
    </label>
    <div class="password-input-wrapper">
      <input
        [type]="showCurrentPasswordField ? 'text' : 'password'"
        id="currentPassword"
        formControlName="currentPassword"
        class="form-control"
        [class.error]="passwordForm.get('currentPassword')?.invalid && passwordForm.get('currentPassword')?.touched"
        placeholder="Ingresa tu contraseña actual"
      />
      <button
        type="button"
        class="password-toggle"
        (click)="togglePasswordVisibility('current')"
        tabindex="-1"
      >
        <i class="fas" [class.fa-eye]="!showCurrentPasswordField" [class.fa-eye-slash]="showCurrentPasswordField"></i>
      </button>
    </div>
    <span class="error-message" *ngIf="passwordForm.get('currentPassword')?.invalid && passwordForm.get('currentPassword')?.touched">
      {{ getPasswordError('currentPassword') }}
    </span>
  </div>

  <!-- Nueva Contraseña -->
  <div class="form-group">
    <label for="newPassword" class="form-label">
      <i class="fas fa-lock"></i>
      {{ newPasswordLabel }} <span class="required">*</span>
    </label>
    <div class="password-input-wrapper">
      <input
        [type]="showNewPasswordField ? 'text' : 'password'"
        id="newPassword"
        formControlName="newPassword"
        class="form-control"
        [class.error]="passwordForm.get('newPassword')?.invalid && passwordForm.get('newPassword')?.touched"
        [placeholder]="'Mínimo ' + minLength + ' caracteres'"
      />
      <button
        type="button"
        class="password-toggle"
        (click)="togglePasswordVisibility('new')"
        tabindex="-1"
      >
        <i class="fas" [class.fa-eye]="!showNewPasswordField" [class.fa-eye-slash]="showNewPasswordField"></i>
      </button>
    </div>
    <span class="error-message" *ngIf="passwordForm.get('newPassword')?.invalid && passwordForm.get('newPassword')?.touched">
      {{ getPasswordError('newPassword') }}
    </span>
    <div class="password-requirements" *ngIf="showPasswordRequirements">
      <small class="requirements-text">
        <i class="fas fa-info-circle"></i>
        La contraseña debe tener al menos {{ minLength }} caracteres, incluir mayúsculas, minúsculas, números y caracteres especiales
      </small>
    </div>
  </div>

  <!-- Confirmar Contraseña -->
  <div class="form-group">
    <label for="confirmPassword" class="form-label">
      <i class="fas fa-lock"></i>
      {{ confirmLabel }} <span class="required">*</span>
    </label>
    <div class="password-input-wrapper">
      <input
        [type]="showConfirmPasswordField ? 'text' : 'password'"
        id="confirmPassword"
        formControlName="confirmPassword"
        class="form-control"
        [class.error]="passwordForm.get('confirmPassword')?.invalid && passwordForm.get('confirmPassword')?.touched || passwordForm.errors?.['passwordMismatch']"
        placeholder="Confirma tu nueva contraseña"
      />
      <button
        type="button"
        class="password-toggle"
        (click)="togglePasswordVisibility('confirm')"
        tabindex="-1"
      >
        <i class="fas" [class.fa-eye]="!showConfirmPasswordField" [class.fa-eye-slash]="showConfirmPasswordField"></i>
      </button>
    </div>
    <span class="error-message" *ngIf="passwordForm.get('confirmPassword')?.invalid && passwordForm.get('confirmPassword')?.touched">
      {{ getPasswordError('confirmPassword') }}
    </span>
    <span class="error-message" *ngIf="passwordForm.errors?.['passwordMismatch'] && passwordForm.get('confirmPassword')?.touched">
      Las contraseñas no coinciden
    </span>
  </div>
  </form>
</div>

