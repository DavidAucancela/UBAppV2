<div class="dashboard-container">
  <!-- Vista Analytics -->
  <div class="analytics-view">
    <div class="analytics-container">
      <!-- Header con controles -->
      <div class="analytics-header">
        <div class="header-content">
          <h1><i class="fas fa-chart-line"></i> Analytics Dashboard</h1>
          <p>Visualización avanzada de datos y análisis de tendencias</p>
        </div>
        <div class="header-actions">
          <button class="btn btn-secondary" (click)="exportData('pdf')">
            <i class="fas fa-file-pdf"></i> Exportar PDF
          </button>
          <button class="btn btn-secondary" (click)="exportData('excel')">
            <i class="fas fa-file-excel"></i> Exportar Excel
          </button>
          <button class="btn btn-secondary" (click)="resetFilters()">
            <i class="fas fa-redo"></i> Resetear
          </button>
        </div>
      </div>

      <!-- Panel de filtros -->
      <div class="filters-panel">
        <div class="filter-group">
          <label><i class="fas fa-calendar"></i> Período</label>
          <select [(ngModel)]="filters.periodo" (change)="onFilterChange()" class="filter-select">
            <option *ngFor="let periodo of periodos" [value]="periodo.value">
              {{ periodo.label }}
            </option>
          </select>
        </div>

        <div class="filter-group">
          <label><i class="fas fa-chart-bar"></i> Tipo de gráfico</label>
          <div class="chart-type-buttons">
            <button 
              *ngFor="let tipo of tiposGrafico" 
              [class.active]="filters.tipoGrafico === tipo.value"
              (click)="filters.tipoGrafico = tipo.value; onFilterChange()"
              class="chart-type-btn"
              [title]="tipo.label">
              <i class="fas" [ngClass]="tipo.icon"></i>
            </button>
          </div>
        </div>

        <div class="filter-group">
          <label><i class="fas fa-filter"></i> Métrica</label>
          <div class="metric-buttons">
            <button 
              *ngFor="let metrica of metricas"
              [class.active]="filters.metrica === metrica.value"
              (click)="filters.metrica = metrica.value; onFilterChange()"
              class="metric-btn">
              <i class="fas" [ngClass]="metrica.icon"></i>
              {{ metrica.label }}
            </button>
          </div>
        </div>
      </div>

      <!-- KPIs Cards -->
      <div class="kpis-section">
        <div class="kpi-card">
          <div class="kpi-icon success">
            <i class="fas fa-truck"></i>
          </div>
          <div class="kpi-content">
            <h3>{{ kpis.totalEnvios }}</h3>
            <p>Total Envíos</p>
            <span class="kpi-trend positive" *ngIf="kpis.tasaCrecimiento > 0">
              <i class="fas fa-arrow-up"></i> {{ kpis.tasaCrecimiento | number:'1.1-1' }}%
            </span>
            <span class="kpi-trend negative" *ngIf="kpis.tasaCrecimiento < 0">
              <i class="fas fa-arrow-down"></i> {{ kpis.tasaCrecimiento | number:'1.1-1' }}%
            </span>
          </div>
        </div>

        <div class="kpi-card">
          <div class="kpi-icon warning">
            <i class="fas fa-clock"></i>
          </div>
          <div class="kpi-content">
            <h3>{{ kpis.enviosPendientes }}</h3>
            <p>Envíos Pendientes</p>
            <span class="kpi-badge">Requiere atención</span>
          </div>
        </div>


        <div class="kpi-card">
          <div class="kpi-icon info">
            <i class="fas fa-dollar-sign"></i>
          </div>
          <div class="kpi-content">
            <h3>${{ kpis.valorPromedio | number:'1.2-2' }}</h3>
            <p>Valor Promedio</p>
          </div>
        </div>

        <div class="kpi-card">
          <div class="kpi-icon success">
            <i class="fas fa-star"></i>
          </div>
          <div class="kpi-content">
            <h3>{{ kpis.satisfaccionCliente | number:'1.1-1' }}%</h3>
            <p>Satisfacción Cliente</p>
            <span class="kpi-badge success">Excelente</span>
          </div>
        </div>
      </div>

      <!-- Charts Grid -->
      <div class="charts-grid">
        <!-- Gráfico principal de envíos -->
        <div class="chart-container large" [class.fullscreen]="isFullscreen('envios')">
          <div class="chart-header">
            <h2><i class="fas fa-truck"></i> Evolución de Envíos</h2>
            <div class="chart-actions">
              <button class="icon-btn" title="Descargar" (click)="downloadChart('envios')">
                <i class="fas fa-download"></i>
              </button>
              <button class="icon-btn" title="Pantalla completa" (click)="toggleFullscreen('envios')">
                <i class="fas" [ngClass]="isFullscreen('envios') ? 'fa-compress' : 'fa-expand'"></i>
              </button>
            </div>
          </div>
          <div class="chart-body">
            <canvas #enviosChart></canvas>
          </div>
        </div>

        <!-- Gráfico de distribución por estados -->
        <div class="chart-container medium" [class.fullscreen]="isFullscreen('estados')">
          <div class="chart-header">
            <h2><i class="fas fa-chart-pie"></i> Estados de Envíos</h2>
            <div class="chart-actions">
              <button class="icon-btn" title="Descargar" (click)="downloadChart('estados')">
                <i class="fas fa-download"></i>
              </button>
              <button class="icon-btn" title="Pantalla completa" (click)="toggleFullscreen('estados')">
                <i class="fas" [ngClass]="isFullscreen('estados') ? 'fa-compress' : 'fa-expand'"></i>
              </button>
            </div>
          </div>
          <div class="chart-body">
            <canvas #estadosChart></canvas>
          </div>
        </div>

        <!-- Gráfico de productos por categoría -->
        <div class="chart-container medium" [class.fullscreen]="isFullscreen('productos')">
          <div class="chart-header">
            <h2><i class="fas fa-box"></i> Productos por Categoría</h2>
            <div class="chart-actions">
              <button class="icon-btn" title="Descargar" (click)="downloadChart('productos')">
                <i class="fas fa-download"></i>
              </button>
              <button class="icon-btn" title="Pantalla completa" (click)="toggleFullscreen('productos')">
                <i class="fas" [ngClass]="isFullscreen('productos') ? 'fa-compress' : 'fa-expand'"></i>
              </button>
            </div>
          </div>
          <div class="chart-body">
            <canvas #productosChart></canvas>
          </div>
        </div>

        <!-- Gráfico de tendencias y proyección -->
        <div class="chart-container large" [class.fullscreen]="isFullscreen('tendencias')">
          <div class="chart-header">
            <h2><i class="fas fa-chart-area"></i> Análisis de Tendencias y Proyección</h2>
            <div class="chart-actions">
              <button class="icon-btn" title="Descargar" (click)="downloadChart('tendencias')">
                <i class="fas fa-download"></i>
              </button>
              <button class="icon-btn" title="Pantalla completa" (click)="toggleFullscreen('tendencias')">
                <i class="fas" [ngClass]="isFullscreen('tendencias') ? 'fa-compress' : 'fa-expand'"></i>
              </button>
            </div>
          </div>
          <div class="chart-body">
            <canvas #tendenciasChart></canvas>
          </div>
          <div class="chart-footer">
            <p class="chart-info">
              <i class="fas fa-info-circle"></i>
              Proyección basada en tendencias históricas usando regresión lineal
            </p>
          </div>
        </div>

        <!-- Gráfico radar de rendimiento -->
        <div class="chart-container medium" [class.fullscreen]="isFullscreen('categorias')">
          <div class="chart-header">
            <h2><i class="fas fa-chart-area"></i> Rendimiento Multidimensional</h2>
            <div class="chart-actions">
              <button class="icon-btn" title="Descargar" (click)="downloadChart('categorias')">
                <i class="fas fa-download"></i>
              </button>
              <button class="icon-btn" title="Pantalla completa" (click)="toggleFullscreen('categorias')">
                <i class="fas" [ngClass]="isFullscreen('categorias') ? 'fa-compress' : 'fa-expand'"></i>
              </button>
            </div>
          </div>
          <div class="chart-body">
            <canvas #categoriasChart></canvas>
          </div>
        </div>

        <!-- Gráfico de KPIs -->
        <div class="chart-container medium" [class.fullscreen]="isFullscreen('kpi')">
          <div class="chart-header">
            <h2><i class="fas fa-tachometer-alt"></i> Indicadores Clave (KPIs)</h2>
            <div class="chart-actions">
              <button class="icon-btn" title="Descargar" (click)="downloadChart('kpi')">
                <i class="fas fa-download"></i>
              </button>
              <button class="icon-btn" title="Pantalla completa" (click)="toggleFullscreen('kpi')">
                <i class="fas" [ngClass]="isFullscreen('kpi') ? 'fa-compress' : 'fa-expand'"></i>
              </button>
            </div>
          </div>
          <div class="chart-body">
            <canvas #kpiChart></canvas>
          </div>
        </div>
      </div>

      <!-- Insights Section
      <div class="insights-section">
        <div class="section-header">
          <h2><i class="fas fa-lightbulb"></i> Insights y Recomendaciones</h2>
        </div>
        <div class="insights-grid">
          <div class="insight-card" *ngIf="kpis.tasaCrecimiento > 0">
            <div class="insight-icon success">
              <i class="fas fa-arrow-trend-up"></i>
            </div>
            <div class="insight-content">
              <h3>Crecimiento Positivo</h3>
              <p>Los envíos han aumentado un {{ kpis.tasaCrecimiento | number:'1.1-1' }}% este período. Mantén el buen trabajo.</p>
            </div>
          </div>

          <div class="insight-card" *ngIf="kpis.enviosPendientes > kpis.totalEnvios * 0.2">
            <div class="insight-icon warning">
              <i class="fas fa-exclamation-triangle"></i>
            </div>
            <div class="insight-content">
              <h3>Atención Requerida</h3>
              <p>Tienes {{ kpis.enviosPendientes }} envíos pendientes. Considera asignar más recursos.</p>
            </div>
          </div>

          <div class="insight-card" *ngIf="kpis.satisfaccionCliente >= 85">
            <div class="insight-icon success">
              <i class="fas fa-smile"></i>
            </div>
            <div class="insight-content">
              <h3>Alta Satisfacción</h3>
              <p>La satisfacción del cliente es del {{ kpis.satisfaccionCliente | number:'1.1-1' }}%. ¡Excelente servicio!</p>
            </div>
          </div>

          <div class="insight-card">
            <div class="insight-icon info">
              <i class="fas fa-chart-line"></i>
            </div>
            <div class="insight-content">
              <h3>Análisis Predictivo</h3>
              <p>Basado en tendencias, se esperan aproximadamente {{ (kpis.totalEnvios * 1.15) | number:'1.0-0' }} envíos el próximo período.</p>
            </div>
          </div>

          <div class="insight-card">
            <div class="insight-icon primary">
              <i class="fas fa-trophy"></i>
            </div>
            <div class="insight-content">
              <h3>Mejor Rendimiento</h3>
              <p>El mejor día para envíos es típicamente entre martes y jueves.</p>
            </div>
          </div>

          <div class="insight-card">
            <div class="insight-icon gradient">
              <i class="fas fa-bullseye"></i>
            </div>
            <div class="insight-content">
              <h3>Objetivo del Mes</h3>
              <p>Vas por buen camino para alcanzar el objetivo de {{ (kpis.totalEnvios * 1.5) | number:'1.0-0' }} envíos este mes.</p>
            </div>
          </div>
        </div>
      </div> -->

      <!-- Footer con timestamp -->
      <div class="analytics-footer">
        <p>
          <i class="fas fa-clock"></i>
          Última actualización: {{ Date.now() | date:'medium':'':'es-ES' }}
        </p>
      </div>
    </div>
  </div>

  <!-- Overlay de exportación -->
  <div class="exporting-overlay" *ngIf="exportingData">
    <div class="exporting-content">
      <i class="fas fa-spinner fa-spin"></i>
      <h3>Exportando datos...</h3>
      <p>Por favor espera mientras se genera el archivo</p>
    </div>
  </div>
</div>
