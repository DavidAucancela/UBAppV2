<div class="dashboard-container">
  <!-- Loading State -->
  <div class="loading-container" *ngIf="loading">
    <div class="spinner">
      <i class="fas fa-spinner fa-spin"></i>
      <span>Cargando estadísticas del sistema...</span>
    </div>
  </div>

  <!-- Dashboard Content -->
  <div class="dashboard-content" *ngIf="!loading">
    <!-- Header Section -->
    <br>
    <br>
    <br>


    <!-- Main KPIs Section -->
    <div class="main-kpis-section">

      <div class="main-kpis-grid">
        <!-- Total Envíos Card -->
        <div class="main-kpi-card primary">
          <div class="kpi-icon-wrapper">
            <div class="kpi-icon">
              <i class="fas fa-truck"></i>
            </div>
          </div>
          <div class="kpi-content">
            <h3 class="kpi-label">Total Envíos</h3>
            <p class="kpi-value">{{ stats.envios?.total_envios || 0 }}</p>
            <span class="kpi-description">Envíos registrados en el sistema</span>
          </div>
        </div>

        <!-- Pending Envíos Card -->
        <div class="main-kpi-card warning">
          <div class="kpi-icon-wrapper">
            <div class="kpi-icon">
              <i class="fas fa-clock"></i>
            </div>
          </div>
          <div class="kpi-content">
            <h3 class="kpi-label">Envíos Pendientes</h3>
            <p class="kpi-value">{{ stats.envios?.envios_pendientes || 0 }}</p>
            <span class="kpi-description">Requieren atención inmediata</span>
          </div>
        </div>

        <!-- Total Products Card -->
        <div class="main-kpi-card success" *ngIf="canManageEnvios()">
          <div class="kpi-icon-wrapper">
            <div class="kpi-icon">
              <i class="fas fa-box"></i>
            </div>
          </div>
          <div class="kpi-content">
            <h3 class="kpi-label">Total Productos</h3>
            <p class="kpi-value">{{ stats.productos?.total_productos || 0 }}</p>
            <span class="kpi-description">Productos disponibles en inventario</span>
          </div>
        </div>

        <!-- Total Users Card (Admin/Gerente) -->
        <div class="main-kpi-card info" *ngIf="(isAdmin() || isGerente()) && stats.usuarios">
          <div class="kpi-icon-wrapper">
            <div class="kpi-icon">
              <i class="fas fa-users"></i>
            </div>
          </div>
          <div class="kpi-content">
            <h3 class="kpi-label">Total Usuarios</h3>
            <p class="kpi-value">{{ getTotalUsuarios() }}</p>
            <span class="kpi-description">Usuarios activos en el sistema</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Detailed Statistics Grid -->
    <div class="detailed-stats-grid">
      <!-- Users by Role Section (Admin/Gerente) -->
      <div class="stats-category-card" *ngIf="isAdmin() || isGerente()">
        <div class="category-header">
          <div class="category-icon-wrapper users">
            <i class="fas fa-user-friends"></i>
          </div>
          <div class="category-title-wrapper">
            <h2 class="category-title">Usuarios del Sistema</h2>
            <p class="category-subtitle">Distribución por roles y permisos</p>
          </div>
        </div>
        <div class="category-content">
          <div class="category-stats-grid">
            <div class="category-stat-card" *ngFor="let stat of stats.usuarios | keyvalue" 
                 (click)="goToUsuariosWithRole(stat.key)">
              <div class="category-stat-icon" [ngClass]="'role-' + getRoleClass(stat.key)">
                <i class="fas fa-user-tie" *ngIf="stat.key === 'Admin'"></i>
                <i class="fas fa-user-cog" *ngIf="stat.key === 'Gerente'"></i>
                <i class="fas fa-user-edit" *ngIf="stat.key === 'Digitador'"></i>
                <i class="fas fa-user" *ngIf="stat.key === 'Comprador'"></i>
              </div>
              <div class="category-stat-content">
                <h4 class="category-stat-label">{{ stat.key }}</h4>
                <p class="category-stat-value">{{ stat.value }}</p>
              </div>
              <div class="category-stat-arrow">
                <i class="fas fa-chevron-right"></i>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Envíos by Status Section -->
      <div class="stats-category-card">
        <div class="category-header">
          <div class="category-icon-wrapper envios">
            <i class="fas fa-shipping-fast"></i>
          </div>
          <div class="category-title-wrapper">
            <h2 class="category-title">Estado de Envíos</h2>
            <p class="category-subtitle">Distribución por estado actual</p>
          </div>
        </div>
        <div class="category-content">
          <div class="category-stats-grid">
            <div class="category-stat-card" *ngFor="let stat of stats.envios?.por_estado | keyvalue" 
                 (click)="goToEnviosWithEstadoLabel(stat.key)"
                 [ngClass]="'status-' + getStatusClass(stat.key)">
              <div class="category-stat-icon" [ngClass]="getStatusClass(stat.key)">
                <i class="fas fa-check-circle" *ngIf="stat.key === 'Entregado'"></i>
                <i class="fas fa-truck" *ngIf="stat.key === 'En tránsito'"></i>
                <i class="fas fa-clock" *ngIf="stat.key === 'Pendiente'"></i>
                <i class="fas fa-times-circle" *ngIf="stat.key === 'Cancelado'"></i>
              </div>
              <div class="category-stat-content">
                <h4 class="category-stat-label">{{ stat.key }}</h4>
                <p class="category-stat-value">{{ stat.value }}</p>
                <span class="category-stat-percentage">{{ getPercentage(stat.value, stats.envios?.total_envios) }}%</span>
              </div>
              <div class="category-stat-arrow">
                <i class="fas fa-chevron-right"></i>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

