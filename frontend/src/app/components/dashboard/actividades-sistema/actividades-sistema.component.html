<div class="dashboard-container">
  <!-- Loading State -->
  <div class="loading-container" *ngIf="loading">
    <div class="spinner">
      <i class="fas fa-spinner fa-spin"></i>
      <span>Cargando informaci√≥n del sistema...</span>
    </div>
  </div>

  <!-- Dashboard Content -->
  <div class="dashboard-content" *ngIf="!loading">
    <!-- Page Header -->
    <!-- Encabezado mejorado con estilo de otros m√≥dulos -->
    <div class="encabezado">
      <h1 class="titulo-principal">
        <i class="fas fa-chart-line"></i>
        Reportes de pruebas
      </h1>
      <p class="subtitulo">Sistema para evaluaci√≥n de b√∫squeda sem√°ntica</p>
    </div>

    <!-- Tabs Navigation -->
    <div class="tabs-container">
      <button 
        class="tab-button" 
        [class.active]="seccionActiva === 'semanticas'"
        (click)="cambiarSeccion('semanticas')">
        <i class="fas fa-brain"></i>
        M√©tricas sem√°nticas del sistema
      </button>
      <button 
        class="tab-button" 
        [class.active]="seccionActiva === 'rendimiento'"
        (click)="cambiarSeccion('rendimiento')">
        <i class="fas fa-tachometer-alt"></i>
        M√©tricas de rendimiento del sistema
      </button>
    </div>

    <!-- Filtros Globales -->
    <div class="filtros-section">
      <h3>Filtros</h3>
      <div class="filtros-grid">
          <div class="filtro-item">
            <label>Fecha inicio:</label>
            <input type="date" [(ngModel)]="filtroFechaDesde" [ngModelOptions]="{standalone: true}" />
          </div>
          <div class="filtro-item">
            <label>Fecha fin:</label>
            <input type="date" [(ngModel)]="filtroFechaHasta" [ngModelOptions]="{standalone: true}" />
          </div>
        <div class="filtro-item" *ngIf="seccionActiva === 'rendimiento'">
          <label>Nivel de carga de prueba:</label>
          <select [(ngModel)]="filtroNivelCarga" [ngModelOptions]="{standalone: true}">
            <option [ngValue]="null">Todos</option>
            <option [ngValue]="1">1</option>
            <option [ngValue]="10">10</option>
            <option [ngValue]="30">30</option>
          </select>
        </div>
        <div class="filtro-item">
          <button class="btn btn-primary" (click)="aplicarFiltros()">
            <i class="fas fa-filter"></i> Aplicar filtros
          </button>
        </div>
      </div>
    </div>

    <!-- ==================== SECCI√ìN: M√âTRICAS SEM√ÅNTICAS ==================== -->
    <div class="seccion-content" *ngIf="seccionActiva === 'semanticas'">
      
      <!-- Registros de Generaci√≥n de Embeddings -->
      <div class="table-section">
        <div class="section-header">
          <h3><i class="fas fa-vector-square"></i> Registros de Generaci√≥n de Embeddings</h3>
          <div class="section-actions">
            <button class="btn btn-secondary" (click)="cargarRegistrosEmbedding()">
              <i class="fas fa-sync-alt"></i> Actualizar
            </button>
          </div>
        </div>
        
        <!-- Estad√≠sticas de Embeddings Mejoradas -->
        <div class="stats-grid">
          <div class="stat-card">
            <div class="stat-icon" style="background: #6366f1;">
              <i class="fas fa-database"></i>
            </div>
            <div class="stat-content">
              <h3>{{ estadisticasEmbedding.total_registros || 0 }}</h3>
              <p>Total de Registros</p>
            </div>
          </div>
          <div class="stat-card">
            <div class="stat-icon" style="background: #22c55e;">
              <i class="fas fa-check-circle"></i>
            </div>
            <div class="stat-content">
              <h3>{{ estadisticasEmbedding.exitosos || 0 }}</h3>
              <p>Generaciones Exitosas</p>
            </div>
          </div>
          <div class="stat-card">
            <div class="stat-icon" style="background: #ef4444;">
              <i class="fas fa-exclamation-triangle"></i>
            </div>
            <div class="stat-content">
              <h3>{{ estadisticasEmbedding.errores || 0 }}</h3>
              <p>Errores</p>
            </div>
          </div>
          <div class="stat-card">
            <div class="stat-icon" style="background: #f59e0b;">
              <i class="fas fa-clock"></i>
            </div>
            <div class="stat-content">
              <h3>{{ formatearTiempo(estadisticasEmbedding.tiempo_promedio_ms || 0) }}</h3>
              <p>Tiempo Promedio</p>
            </div>
          </div>
        </div>

        <!-- Estad√≠sticas adicionales -->
        <div class="info-box" style="margin-top: 1rem; margin-bottom: 1rem;">
          <div class="info-item">
            <strong>Modelo utilizado:</strong> text-embedding-3-small
          </div>
          <div class="info-item">
            <strong>Dimensiones del vector:</strong> 1536
          </div>
          <div class="info-item">
            <strong>Tasa de √©xito:</strong> 
            {{ estadisticasEmbedding.total_registros > 0 ? 
               ((estadisticasEmbedding.exitosos / estadisticasEmbedding.total_registros) * 100).toFixed(1) : 0 }}%
          </div>
        </div>

        <!-- Tabla de registros mejorada -->
        <div class="table-container">
          <table class="data-table clickable-rows">
            <thead>
              <tr>
                <th>ID</th>
                <th>HAWB</th>
                <th>Estado</th>
                <th>Tiempo (ms)</th>
                <th>Dimensi√≥n</th>
                <th>Modelo</th>
                <th>Tipo Proceso</th>
                <th>Fecha</th>
                <th>Acciones</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let registro of registrosEmbedding.slice(0, 50)" 
                  (click)="verDetalleEmbedding(registro)"
                  class="row-hover">
                <td>{{ registro.id }}</td>
                <td><strong>{{ registro.envio_hawb }}</strong></td>
                <td>
                  <span class="badge" 
                        [class.success]="registro.estado === 'generado'"
                        [class.error]="registro.estado === 'error'"
                        [class.warning]="registro.estado === 'omitido'">
                    <i class="fas" 
                       [class.fa-check-circle]="registro.estado === 'generado'"
                       [class.fa-times-circle]="registro.estado === 'error'"
                       [class.fa-minus-circle]="registro.estado === 'omitido'"></i>
                    {{ registro.estado }}
                  </span>
                </td>
                <td>
                  <span [class.text-success]="registro.tiempo_generacion_ms < 1000"
                        [class.text-warning]="registro.tiempo_generacion_ms >= 1000 && registro.tiempo_generacion_ms < 3000"
                        [class.text-danger]="registro.tiempo_generacion_ms >= 3000">
                    {{ registro.tiempo_generacion_ms }}ms
                  </span>
                </td>
                <td>{{ registro.dimension_embedding }}</td>
                <td><small>{{ registro.modelo_usado }}</small></td>
                <td>
                  <span class="badge" [class.info]="registro.tipo_proceso === 'automatico'"
                        [class.secondary]="registro.tipo_proceso === 'manual'"
                        [class.primary]="registro.tipo_proceso === 'masivo'">
                    {{ registro.tipo_proceso }}
                  </span>
                </td>
                <td><small>{{ formatearFecha(registro.fecha_generacion) }}</small></td>
                <td>
                  <button class="btn-icon" (click)="verDetalleEmbedding(registro); $event.stopPropagation()" 
                          title="Ver detalle">
                    <i class="fas fa-eye"></i>
                  </button>
                </td>
              </tr>
              <tr *ngIf="registrosEmbedding.length === 0">
                <td colspan="9" class="empty-cell">
                  <i class="fas fa-info-circle"></i> No hay registros disponibles
                </td>
              </tr>
            </tbody>
          </table>
        </div>

        <!-- Modal de detalle de embedding -->
        <div class="modal" *ngIf="embeddingSeleccionado" (click)="cerrarDetalleEmbedding()">
          <div class="modal-content" (click)="$event.stopPropagation()">
            <div class="modal-header">
              <h3><i class="fas fa-info-circle"></i> Detalle del Embedding</h3>
              <button class="btn-close" (click)="cerrarDetalleEmbedding()">
                <i class="fas fa-times"></i>
              </button>
            </div>
            <div class="modal-body">
              <div class="detail-grid">
                <div class="detail-item">
                  <strong>ID del Registro:</strong>
                  <span>{{ embeddingSeleccionado.id }}</span>
                </div>
                <div class="detail-item">
                  <strong>HAWB del Env√≠o:</strong>
                  <span class="highlight">{{ embeddingSeleccionado.envio_hawb }}</span>
                </div>
                <div class="detail-item">
                  <strong>Estado:</strong>
                  <span class="badge" 
                        [class.success]="embeddingSeleccionado.estado === 'generado'"
                        [class.error]="embeddingSeleccionado.estado === 'error'"
                        [class.warning]="embeddingSeleccionado.estado === 'omitido'">
                    {{ embeddingSeleccionado.estado }}
                  </span>
                </div>
                <div class="detail-item">
                  <strong>Tiempo de Generaci√≥n:</strong>
                  <span>{{ embeddingSeleccionado.tiempo_generacion_ms }}ms</span>
                </div>
                <div class="detail-item">
                  <strong>Dimensi√≥n del Vector:</strong>
                  <span>{{ embeddingSeleccionado.dimension_embedding }}</span>
                </div>
                <div class="detail-item">
                  <strong>Modelo Utilizado:</strong>
                  <span>{{ embeddingSeleccionado.modelo_usado }}</span>
                </div>
                <div class="detail-item">
                  <strong>Tipo de Proceso:</strong>
                  <span class="badge info">{{ embeddingSeleccionado.tipo_proceso }}</span>
                </div>
                <div class="detail-item">
                  <strong>Fecha de Generaci√≥n:</strong>
                  <span>{{ formatearFecha(embeddingSeleccionado.fecha_generacion) }}</span>
                </div>
                <div class="detail-item" *ngIf="embeddingSeleccionado.embedding_id">
                  <strong>ID del Embedding:</strong>
                  <span>{{ embeddingSeleccionado.embedding_id }}</span>
                </div>
                <div class="detail-item full-width" *ngIf="embeddingSeleccionado.mensaje_error">
                  <strong>Mensaje de Error:</strong>
                  <pre class="error-message">{{ embeddingSeleccionado.mensaje_error }}</pre>
                </div>
              </div>

              <div class="process-info" style="margin-top: 1.5rem;">
                <h4><i class="fas fa-project-diagram"></i> Pipeline Completo del Proceso Sem√°ntico</h4>
                <div class="info-box">
                  <div class="pipeline-section">
                    <h5><i class="fas fa-1"></i> Extracci√≥n y Preparaci√≥n</h5>
                    <ul class="process-details">
                      <li><strong>Datos origen:</strong> Env√≠o {{ embeddingSeleccionado.envio_hawb }}</li>
                      <li><strong>Extracci√≥n:</strong> Texto del HAWB, descripci√≥n de productos, categor√≠as, observaciones</li>
                      <li><strong>Normalizaci√≥n:</strong> Limpieza de caracteres especiales y unificaci√≥n de formato</li>
                      <li><strong>Tokenizaci√≥n:</strong> Preparaci√≥n del texto para el modelo</li>
                    </ul>
                  </div>

                  <div class="pipeline-section">
                    <h5><i class="fas fa-2"></i> Generaci√≥n del Embedding</h5>
                    <ul class="process-details">
                      <li><strong>Modelo IA:</strong> {{ embeddingSeleccionado.modelo_usado }}</li>
                      <li><strong>API:</strong> OpenAI Embeddings API</li>
                      <li><strong>Dimensiones:</strong> Vector de {{ embeddingSeleccionado.dimension_embedding }} dimensiones</li>
                      <li><strong>Tiempo de generaci√≥n:</strong> {{ embeddingSeleccionado.tiempo_generacion_ms }}ms</li>
                      <li><strong>Representaci√≥n:</strong> Vector denso en espacio sem√°ntico continuo</li>
                    </ul>
                  </div>

                  <div class="pipeline-section">
                    <h5><i class="fas fa-3"></i> Almacenamiento e Indexaci√≥n</h5>
                    <ul class="process-details">
                      <li><strong>Base de datos:</strong> PostgreSQL con extensi√≥n pgvector</li>
                      <li><strong>Tabla:</strong> envio_embedding</li>
                      <li><strong>Indexaci√≥n:</strong> IVFFlat index para b√∫squeda r√°pida</li>
                      <li><strong>M√©trica de distancia:</strong> Similitud del coseno</li>
                    </ul>
                  </div>

                  <div class="pipeline-section">
                    <h5><i class="fas fa-4"></i> Proceso de B√∫squeda Sem√°ntica</h5>
                    <ul class="process-details">
                      <li><strong>Consulta del usuario:</strong> Texto en lenguaje natural</li>
                      <li><strong>Embedding de consulta:</strong> Mismo modelo para consistencia</li>
                      <li><strong>C√°lculo de similitud:</strong> Producto escalar normalizado (similitud del coseno)</li>
                      <li><strong>Ranking:</strong> Ordenamiento por score de similitud (0-1)</li>
                      <li><strong>Filtrado:</strong> Threshold m√≠nimo de 0.7 para relevancia</li>
                      <li><strong>Resultados:</strong> Top-K env√≠os m√°s similares</li>
                    </ul>
                  </div>

                  <div class="pipeline-section">
                    <h5><i class="fas fa-5"></i> M√©tricas de Calidad</h5>
                    <ul class="process-details">
                      <li><strong>Precisi√≥n:</strong> Relevancia de los resultados devueltos</li>
                      <li><strong>Recall:</strong> Cobertura de documentos relevantes</li>
                      <li><strong>MRR:</strong> Mean Reciprocal Rank - posici√≥n del primer resultado relevante</li>
                      <li><strong>nDCG&#64;K:</strong> Normalized Discounted Cumulative Gain - calidad del ranking</li>
                    </ul>
                  </div>

                  <div class="performance-note" [class.excellent]="embeddingSeleccionado.tiempo_generacion_ms < 1000"
                       [class.good]="embeddingSeleccionado.tiempo_generacion_ms >= 1000 && embeddingSeleccionado.tiempo_generacion_ms < 3000"
                       [class.needs-optimization]="embeddingSeleccionado.tiempo_generacion_ms >= 3000">
                    <i class="fas fa-bolt"></i>
                    <strong>Evaluaci√≥n de Rendimiento:</strong> 
                    <span class="performance-label">
                      {{ embeddingSeleccionado.tiempo_generacion_ms < 1000 ? 'üöÄ Excelente' : 
                         embeddingSeleccionado.tiempo_generacion_ms < 3000 ? '‚úÖ Bueno' : '‚ö†Ô∏è Necesita Optimizaci√≥n' }}
                    </span>
                    <br>
                    <small>
                      Tiempo: {{ embeddingSeleccionado.tiempo_generacion_ms }}ms 
                      (√ìptimo: < 1000ms | Aceptable: < 3000ms)
                    </small>
                  </div>
                </div>
              </div>
            </div>
            <div class="modal-footer">
              <button class="btn btn-secondary" (click)="cerrarDetalleEmbedding()">
                <i class="fas fa-times"></i> Cerrar
              </button>
            </div>
          </div>
        </div>
      </div>

    </div>

    <!-- ==================== SECCI√ìN: M√âTRICAS DE RENDIMIENTO ==================== -->
    <div class="seccion-content" *ngIf="seccionActiva === 'rendimiento'">
      
      <!-- Estad√≠sticas Resumen -->
      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-icon" style="background: #3b82f6;">
            <i class="fas fa-clock"></i>
          </div>
          <div class="stat-content">
            <h3>{{ formatearTiempo(estadisticasRendimiento.tiempo_promedio_ms || 0) }}</h3>
            <p>Tiempo promedio de respuesta</p>
          </div>
        </div>
        <div class="stat-card">
          <div class="stat-icon" style="background: #ef4444;">
            <i class="fas fa-microchip"></i>
          </div>
          <div class="stat-content">
            <h3>{{ estadisticasRendimiento.cpu_promedio?.toFixed(2) || '0.00' }}%</h3>
            <p>CPU promedio</p>
          </div>
        </div>
        <div class="stat-card">
          <div class="stat-icon" style="background: #22c55e;">
            <i class="fas fa-memory"></i>
          </div>
          <div class="stat-content">
            <h3>{{ estadisticasRendimiento.ram_promedio_mb?.toFixed(2) || '0.00' }} MB</h3>
            <p>RAM promedio</p>
          </div>
        </div>
        <div class="stat-card">
          <div class="stat-icon" style="background: #f59e0b;">
            <i class="fas fa-check-circle"></i>
          </div>
          <div class="stat-content">
            <h3>{{ estadisticasRendimiento.total_exitosos || 0 }}</h3>
              <p>Operaciones exitosas</p>
          </div>
        </div>
      </div>

      <!-- Gr√°fico Comparativo de Procesos M1-M14 -->
      <div class="chart-section" style="margin-bottom: 2rem;">
        <div class="chart-header">
          <h3><i class="fas fa-chart-bar"></i> Comparativa de Procesos (M1-M14)</h3>
        </div>
        <div class="chart-container" style="height: 450px;">
          <canvas #chartComparativoProcesos></canvas>
        </div>
        <div class="info-box" style="margin-top: 1rem;">
          <p><i class="fas fa-info-circle"></i> <strong>Nota:</strong> Este gr√°fico muestra el tiempo promedio de cada uno de los 14 procesos clave del sistema. Los colores indican la categor√≠a seg√∫n ISO 25010.</p>
        </div>
      </div>

      <!-- Gr√°ficos de Rendimiento -->
      <div class="charts-grid">
        <div class="chart-section">
          <div class="chart-header">
            <h3>Tiempos de respuesta</h3>
            <button class="btn btn-secondary btn-sm" (click)="exportarCSVGraficoTiempos()" [disabled]="metricasRendimiento.length === 0">
              <i class="fas fa-download"></i> Exportar CSV
            </button>
          </div>
          <div class="chart-container">
            <canvas #chartTiemposRendimiento></canvas>
          </div>
        </div>
        <div class="chart-section">
          <div class="chart-header">
            <h3>Utilizaci√≥n de recursos</h3>
            <button class="btn btn-secondary btn-sm" (click)="exportarCSVGraficoRecursos()" [disabled]="metricasRendimiento.length === 0">
              <i class="fas fa-download"></i> Exportar CSV
            </button>
          </div>
          <div class="chart-container">
            <canvas #chartRecursos></canvas>
          </div>
        </div>
      </div>

      <!-- Pruebas de Rendimiento Completas -->
      <div class="section-card" style="margin-bottom: 2rem;">
        <div class="section-header">
          <h3><i class="fas fa-flask"></i> Pruebas de Rendimiento Completas (ISO 25010)</h3>
        </div>
        
        <!-- Formulario de Ejecuci√≥n -->
        <div class="form-grid">
          <div class="form-item">
            <label>N√∫mero de iteraciones por prueba:</label>
            <select [(ngModel)]="iteracionesPrueba" [ngModelOptions]="{standalone: true}" [disabled]="ejecutandoPruebaCompleta">
              <option [ngValue]="24">24 (Recomendado)</option>
              <option [ngValue]="30">30 (Est√°ndar)</option>
              <option [ngValue]="50">50 (Extendido)</option>
            </select>
          </div>
        </div>
        <p class="info-text">
          <i class="fas fa-info-circle"></i>
          Esta prueba ejecuta los 14 procesos clave del sistema (M1-M14) 
          con medici√≥n completa de recursos (CPU y RAM) seg√∫n el Marco Metodol√≥gico ISO 25010.
        </p>
        <button 
          class="btn btn-primary" 
          (click)="ejecutarPruebaRendimientoCompleta()" 
          [disabled]="ejecutandoPruebaCompleta">
          <i class="fas" [class.fa-play]="!ejecutandoPruebaCompleta" [class.fa-spinner]="ejecutandoPruebaCompleta" [class.fa-spin]="ejecutandoPruebaCompleta"></i> 
          {{ ejecutandoPruebaCompleta ? 'Ejecutando pruebas (puede tardar varios minutos)...' : 'Ejecutar Pruebas Completas' }}
        </button>

        <!-- Historial de Pruebas Ejecutadas -->
        <div class="table-section" style="margin-top: 2rem;">
          <h4><i class="fas fa-history"></i> Historial de Pruebas Ejecutadas</h4>
          <div class="table-container">
            <table class="data-table clickable-rows">
              <thead>
                <tr>
                  <th>ID</th>
                  <th>Fecha de Ejecuci√≥n</th>
                  <th>Usuario</th>
                  <th>Estado</th>
                  <th>Acciones</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let prueba of pruebasRendimientoCompletas.slice(0, 10)" 
                    (click)="verDetallePrueba(prueba)"
                    class="row-hover">
                  <td>{{ prueba.id }}</td>
                  <td>{{ formatearFecha(prueba.fecha_ejecucion) }}</td>
                  <td>{{ prueba.usuario_ejecutor_username || 'N/A' }}</td>
                  <td>
                    <span class="badge" [class.success]="prueba.completada" [class.error]="!prueba.completada">
                      {{ prueba.completada ? 'Completada' : 'Con errores' }}
                    </span>
                  </td>
                  <td>
                    <button class="btn-icon" (click)="verDetallePrueba(prueba); $event.stopPropagation()" title="Ver detalle">
                      <i class="fas fa-eye"></i>
                    </button>
                  </td>
                </tr>
                <tr *ngIf="pruebasRendimientoCompletas.length === 0">
                  <td colspan="5" class="empty-cell">
                    <i class="fas fa-info-circle"></i> No hay pruebas ejecutadas a√∫n
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>

        <!-- Modal de Resultados Completo -->
        <div class="modal" *ngIf="resultadosPruebaCompleta" (click)="cerrarResultadosPrueba()">
          <div class="modal-content modal-resultados" (click)="$event.stopPropagation()">
            <div class="modal-header">
              <h3><i class="fas fa-chart-bar"></i> Resultados de Pruebas de Rendimiento Completas (ISO 25010)</h3>
              <button class="btn-close" (click)="cerrarResultadosPrueba()">
                <i class="fas fa-times"></i>
              </button>
            </div>
            <div class="modal-body">
              <!-- Fecha y usuario -->
              <div class="info-box" style="margin-bottom: 1.5rem;">
                <div class="info-item">
                  <strong>Fecha de ejecuci√≥n:</strong> 
                  {{ resultadosPruebaCompleta.fecha_ejecucion ? formatearFecha(resultadosPruebaCompleta.fecha_ejecucion) : 'No disponible' }}
                </div>
                <div class="info-item">
                  <strong>Iteraciones:</strong> {{ iteracionesPrueba }}
                </div>
              </div>

              <!-- Mensaje y salida -->
              <div *ngIf="resultadosPruebaCompleta.mensaje" class="alert alert-success">
                <i class="fas fa-check-circle"></i> {{ resultadosPruebaCompleta.mensaje }}
              </div>

              <!-- Salida de pruebas -->
              <div *ngIf="resultadosPruebaCompleta.salida" class="output-box">
                <h4><i class="fas fa-terminal"></i> Salida de la Ejecuci√≥n</h4>
                <pre class="code-output">{{ resultadosPruebaCompleta.salida }}</pre>
              </div>

              <!-- Resultados espec√≠ficos si est√°n disponibles -->
              <div *ngIf="resultadosPruebaCompleta.resultados" class="resultados-section">
                <h4><i class="fas fa-chart-line"></i> Resultados Detallados</h4>
                
                <!-- Estad√≠sticas de registro -->
                <div class="stat-card" *ngIf="resultadosPruebaCompleta.resultados.tiempo_respuesta">
                  <div class="stat-content">
                    <h5>Tiempo de Respuesta</h5>
                    <p>Promedio Web: {{ resultadosPruebaCompleta.resultados.tiempo_respuesta.web_promedio?.toFixed(4) }}s</p>
                    <p>Manual Estimado: {{ resultadosPruebaCompleta.resultados.tiempo_respuesta.manual_estimado }}s</p>
                    <p class="mejora">Mejora: {{ resultadosPruebaCompleta.resultados.tiempo_respuesta.mejora?.toFixed(1) }}x m√°s r√°pido</p>
                  </div>
                </div>
              </div>

              <!-- Errores si los hay -->
              <div *ngIf="resultadosPruebaCompleta.errores" class="alert alert-warning">
                <h4><i class="fas fa-exclamation-triangle"></i> Errores Encontrados</h4>
                <pre class="code-output error">{{ resultadosPruebaCompleta.errores }}</pre>
              </div>
            </div>
            <div class="modal-footer">
              <button class="btn btn-primary" (click)="cerrarResultadosPrueba()">
                <i class="fas fa-check"></i> Cerrar
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- Modal de Detalle de Prueba -->
      <div class="modal" *ngIf="pruebaSeleccionada" (click)="cerrarDetallePrueba()">
        <div class="modal-content modal-resultados" (click)="$event.stopPropagation()">
          <div class="modal-header">
            <h3><i class="fas fa-file-alt"></i> Detalle de Prueba de Rendimiento #{{ pruebaSeleccionada.id }}</h3>
            <button class="btn-close" (click)="cerrarDetallePrueba()">
              <i class="fas fa-times"></i>
            </button>
          </div>
          <div class="modal-body">
            <!-- Informaci√≥n general -->
            <div class="info-box" style="margin-bottom: 1.5rem;">
              <div class="info-item">
                <strong>Fecha:</strong> {{ formatearFecha(pruebaSeleccionada.fecha_ejecucion) }}
              </div>
              <div class="info-item">
                <strong>Usuario:</strong> {{ pruebaSeleccionada.usuario_ejecutor_username || 'N/A' }}
              </div>
              <div class="info-item">
                <strong>Estado:</strong> 
                <span class="badge" [class.success]="pruebaSeleccionada.completada" [class.error]="!pruebaSeleccionada.completada">
                  {{ pruebaSeleccionada.completada ? 'Completada' : 'Con errores' }}
                </span>
              </div>
            </div>

            <!-- Resultados por proceso -->
            <div *ngIf="pruebaSeleccionada.resultados_json" class="procesos-grid">
              <h4><i class="fas fa-cogs"></i> Resultados por Proceso</h4>
              <div class="table-container">
                <table class="data-table">
                  <thead>
                    <tr>
                      <th>Proceso</th>
                      <th>Tiempo (s)</th>
                      <th>CPU (%)</th>
                      <th>RAM (KB)</th>
                      <th>Calificaci√≥n Tiempo</th>
                      <th>Iteraciones</th>
                      <th>Errores</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr *ngFor="let proceso of obtenerProcesosOrdenados(pruebaSeleccionada.resultados_json)">
                      <td><strong>{{ proceso.codigo }}</strong></td>
                      <td>{{ proceso.tiempo_media?.toFixed(3) || '-' }}</td>
                      <td>{{ proceso.cpu_media?.toFixed(4) || '-' }}</td>
                      <td>{{ proceso.ram_media?.toFixed(2) || '-' }}</td>
                      <td>
                        <span class="badge" [style.background-color]="obtenerColorEstado(proceso.categoria_tiempo)">
                          {{ proceso.categoria_tiempo }}
                        </span>
                      </td>
                      <td>{{ proceso.iteraciones_completadas || 0 }}</td>
                      <td>
                        <span class="badge" [class.success]="!proceso.error" [class.error]="proceso.error">
                          {{ proceso.total_errores || 0 }}
                        </span>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>

            <!-- Errores si los hay -->
            <div *ngIf="pruebaSeleccionada.errores" class="alert alert-warning" style="margin-top: 1rem;">
              <div>
                <h4><i class="fas fa-exclamation-triangle"></i> Errores de la Prueba</h4>
                <pre class="code-output error">{{ pruebaSeleccionada.errores }}</pre>
              </div>
            </div>
          </div>
          <div class="modal-footer">
            <button class="btn btn-secondary" (click)="cerrarDetallePrueba()">
              <i class="fas fa-times"></i> Cerrar
            </button>
          </div>
        </div>
      </div>

    </div>

  </div>
</div>
