<div class="perfil-container">
  <!-- Header -->
  <div class="perfil-header">
    <div class="container">
      <div class="header-content">
        <div class="header-icon">
          <i class="fas fa-user-circle"></i>
        </div>
        <div class="header-text">
          <h1>Mi Perfil</h1>
          <p>Administra tu información personal y configuración de cuenta</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Main Content -->
  <div class="container">
    <div class="perfil-content">
      
      <!-- Información del Usuario -->
      <div class="user-card">
        <div class="user-avatar-large">
          <i class="fas fa-user-circle"></i>
          <div class="avatar-badge">
            <i class="fas fa-check"></i>
          </div>
        </div>
        <h3 *ngIf="currentUser">{{ currentUser.nombre }}</h3>
        <p class="user-email" *ngIf="currentUser">{{ currentUser.correo }}</p>
        <span class="role-badge" *ngIf="currentUser">
          <i class="fas fa-shield-alt"></i>
          {{ currentUser.rol_nombre }}
        </span>
      </div>

      <!-- Formulario de Perfil -->
      <div class="form-card">
        <div class="card-header">
          <h3>
            <i class="fas fa-user-edit"></i>
            Información Personal
          </h3>
        </div>
        
        <form [formGroup]="profileForm" (ngSubmit)="onSubmitProfile()">
          <div class="form-row">
            <div class="form-group">
              <label for="nombre">
                <i class="fas fa-user"></i>
                Nombre Completo <span class="required">*</span>
              </label>
              <input
                type="text"
                id="nombre"
                formControlName="nombre"
                class="form-control"
                [class.error]="isFieldInvalid(profileForm, 'nombre')"
                placeholder="Ingresa tu nombre completo">
              <span class="error-message" *ngIf="isFieldInvalid(profileForm, 'nombre')">
                {{ getFieldError(profileForm, 'nombre') }}
              </span>
            </div>

            <div class="form-group">
              <label for="correo">
                <i class="fas fa-envelope"></i>
                Correo Electrónico <span class="required">*</span>
              </label>
              <input
                type="email"
                id="correo"
                formControlName="correo"
                class="form-control"
                [class.error]="isFieldInvalid(profileForm, 'correo')"
                placeholder="correo@ejemplo.com">
              <span class="error-message" *ngIf="isFieldInvalid(profileForm, 'correo')">
                {{ getFieldError(profileForm, 'correo') }}
              </span>
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="telefono">
                <i class="fas fa-phone"></i>
                Teléfono
              </label>
              <input
                type="tel"
                id="telefono"
                formControlName="telefono"
                class="form-control"
                [class.error]="isFieldInvalid(profileForm, 'telefono')"
                placeholder="0987654321">
              <span class="error-message" *ngIf="isFieldInvalid(profileForm, 'telefono')">
                {{ getFieldError(profileForm, 'telefono') }}
              </span>
            </div>

            <div class="form-group">
              <label for="direccion">
                <i class="fas fa-map-marker-alt"></i>
                Dirección
              </label>
              <input
                type="text"
                id="direccion"
                formControlName="direccion"
                class="form-control"
                placeholder="Tu dirección">
            </div>
          </div>

          <!-- Mensajes de éxito/error -->
          <div class="alert alert-success" *ngIf="profileSuccess">
            <i class="fas fa-check-circle"></i>
            <span>Perfil actualizado correctamente</span>
          </div>

          <div class="alert alert-error" *ngIf="profileError">
            <i class="fas fa-exclamation-circle"></i>
            <span>{{ profileError }}</span>
          </div>

          <div class="form-actions">
            <button type="submit" class="btn btn-primary" [disabled]="loading || profileForm.invalid">
              <i class="fas fa-save"></i>
              <span *ngIf="!loading">Guardar Cambios</span>
              <span *ngIf="loading">
                <i class="fas fa-spinner fa-spin"></i>
                Guardando...
              </span>
            </button>
          </div>
        </form>
      </div>

      <!-- Formulario de Contraseña -->
      <div class="form-card">
        <div class="card-header">
          <h3>
            <i class="fas fa-lock"></i>
            Seguridad
          </h3>
          <button class="btn-toggle" (click)="togglePasswordForm()">
            <i class="fas" [class.fa-chevron-down]="!showPasswordForm" [class.fa-chevron-up]="showPasswordForm"></i>
            {{ showPasswordForm ? 'Ocultar' : 'Cambiar Contraseña' }}
          </button>
        </div>

        <div class="password-section" *ngIf="showPasswordForm">
          <form [formGroup]="passwordForm" (ngSubmit)="onSubmitPassword()">
            <div class="form-group">
              <label for="currentPassword">
                <i class="fas fa-key"></i>
                Contraseña Actual <span class="required">*</span>
              </label>
              <div class="password-input-wrapper">
                <input
                  [type]="showCurrentPassword ? 'text' : 'password'"
                  id="currentPassword"
                  formControlName="currentPassword"
                  class="form-control"
                  [class.error]="isFieldInvalid(passwordForm, 'currentPassword')"
                  placeholder="Ingresa tu contraseña actual">
                <button type="button" class="password-toggle" (click)="togglePasswordVisibility('current')">
                  <i class="fas" [class.fa-eye]="!showCurrentPassword" [class.fa-eye-slash]="showCurrentPassword"></i>
                </button>
              </div>
              <span class="error-message" *ngIf="isFieldInvalid(passwordForm, 'currentPassword')">
                {{ getFieldError(passwordForm, 'currentPassword') }}
              </span>
            </div>

            <div class="form-group">
              <label for="newPassword">
                <i class="fas fa-lock"></i>
                Nueva Contraseña <span class="required">*</span>
              </label>
              <div class="password-input-wrapper">
                <input
                  [type]="showNewPassword ? 'text' : 'password'"
                  id="newPassword"
                  formControlName="newPassword"
                  class="form-control"
                  [class.error]="isFieldInvalid(passwordForm, 'newPassword')"
                  placeholder="Mínimo 6 caracteres">
                <button type="button" class="password-toggle" (click)="togglePasswordVisibility('new')">
                  <i class="fas" [class.fa-eye]="!showNewPassword" [class.fa-eye-slash]="showNewPassword"></i>
                </button>
              </div>
              <span class="error-message" *ngIf="isFieldInvalid(passwordForm, 'newPassword')">
                {{ getFieldError(passwordForm, 'newPassword') }}
              </span>
            </div>

            <div class="form-group">
              <label for="confirmPassword">
                <i class="fas fa-lock"></i>
                Confirmar Nueva Contraseña <span class="required">*</span>
              </label>
              <div class="password-input-wrapper">
                <input
                  [type]="showConfirmPassword ? 'text' : 'password'"
                  id="confirmPassword"
                  formControlName="confirmPassword"
                  class="form-control"
                  [class.error]="isFieldInvalid(passwordForm, 'confirmPassword') || passwordForm.errors?.['mismatch']"
                  placeholder="Confirma tu nueva contraseña">
                <button type="button" class="password-toggle" (click)="togglePasswordVisibility('confirm')">
                  <i class="fas" [class.fa-eye]="!showConfirmPassword" [class.fa-eye-slash]="showConfirmPassword"></i>
                </button>
              </div>
              <span class="error-message" *ngIf="isFieldInvalid(passwordForm, 'confirmPassword')">
                {{ getFieldError(passwordForm, 'confirmPassword') }}
              </span>
              <span class="error-message" *ngIf="passwordForm.errors?.['mismatch'] && passwordForm.get('confirmPassword')?.touched">
                Las contraseñas no coinciden
              </span>
            </div>

            <!-- Mensajes de éxito/error -->
            <div class="alert alert-success" *ngIf="passwordSuccess">
              <i class="fas fa-check-circle"></i>
              <span>Contraseña actualizada correctamente</span>
            </div>

            <div class="alert alert-error" *ngIf="passwordError">
              <i class="fas fa-exclamation-circle"></i>
              <span>{{ passwordError }}</span>
            </div>

            <div class="form-actions">
              <button type="button" class="btn btn-secondary" (click)="togglePasswordForm()" [disabled]="loading">
                <i class="fas fa-times"></i>
                Cancelar
              </button>
              <button type="submit" class="btn btn-primary" [disabled]="loading || passwordForm.invalid">
                <i class="fas fa-check"></i>
                <span *ngIf="!loading">Cambiar Contraseña</span>
                <span *ngIf="loading">
                  <i class="fas fa-spinner fa-spin"></i>
                  Actualizando...
                </span>
              </button>
            </div>
          </form>
        </div>
      </div>

    </div>
  </div>
</div>
