<div class="mis-envios-container">
  <!-- Header -->
  <div class="encabezado">
    <h1 class="titulo-principal">
      <i class="fas fa-box-seam"></i>
      Mis envíos
    </h1>
    <p class="subtitulo">Gestiona y visualiza todos tus envíos asignados</p>
  </div>

  <!-- Main Content -->
  <div class="container">
    <div class="mis-envios-content">
      <!-- Filters Card -->
      <div class="card">
        <div class="card-header-filters">
          <h5>
            <i class="fas fa-filter"></i>
            Filtros de búsqueda
          </h5>
        </div>

        <!-- Filters -->
        <div class="filters-section">
          <div class="filter-row">
            <!-- Estado Filter -->
            <div class="filter-group">
              <label class="filter-label">
                <i class="fas fa-filter"></i>
                Estado
              </label>
              <select class="form-control" [(ngModel)]="filtroEstado">
                <option value="">Todos los estados</option>
                <option value="pendiente">Pendiente</option>
                <option value="en_transito">En tránsito</option>
                <option value="entregado">Entregado</option>
                <option value="cancelado">Cancelado</option>
              </select>
            </div>

            <!-- Fecha desde -->
            <div class="filter-group">
              <label class="filter-label">
                <i class="fas fa-calendar-alt"></i>
                Desde
              </label>
              <input type="date" class="form-control" [(ngModel)]="filtroFechaDesde">
            </div>

            <!-- Fecha Hasta -->
            <div class="filter-group">
              <label class="filter-label">
                <i class="fas fa-calendar-alt"></i>
                Hasta
              </label>
              <input type="date" class="form-control" [(ngModel)]="filtroFechaHasta">
            </div>

            <!-- Botón Filtrar -->
            <div class="filter-group filter-button-group">
              <button class="btn btn-primary filter-button" (click)="aplicarFiltros()">
                <i class="fas fa-search"></i>
                Filtrar
              </button>
            </div>
          </div>
        </div>

        <!-- Results Summary -->
        <div class="results-summary">
          <div class="results-summary-content">
            <span class="results-count">
              <i class="fas fa-list"></i>
              Total de envíos: {{ totalEnvios }}
            </span>
            <button class="btn btn-outline-secondary btn-sm" (click)="limpiarFiltros()">
              <i class="fas fa-x-circle"></i>
              Limpiar 
            </button>
          </div>
        </div>
      </div>

      <!-- Success Message -->
      <div class="alert alert-success" *ngIf="!error && !loading && envios.length > 0">
        <i class="fas fa-check-circle"></i>
        Se encontraron {{ envios.length }} envío(s)
      </div>

      <!-- Error Message -->
      <div class="alert alert-danger" *ngIf="error">
        <i class="fas fa-exclamation-triangle-fill"></i>
        {{ error }}
      </div>

      <!-- Loading State -->
      <div class="loading-state" *ngIf="loading">
        <i class="fas fa-spinner fa-spin"></i>
        <span>Cargando envíos...</span>
      </div>

      <!-- Table -->
      <div class="card" *ngIf="!loading && !error">
        <div class="table-container">
          <div *ngIf="envios.length === 0" class="no-data">
            <i class="fas fa-inbox"></i>
            <p>No se encontraron envíos</p>
          </div>

          <div *ngIf="envios.length > 0" class="table-responsive">
            <table class="table table-hover">
              <thead>
                <tr>
                  <th>HAWB</th>
                  <th>Fecha Emisión</th>
                  <th>Estado</th>
                  <th class="text-end">Peso Total</th>
                  <th class="text-end">Cantidad</th>
                  <th class="text-end">Valor Total</th>
                  <th class="text-end">Costo Servicio</th>
                  <th>Observaciones</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let envio of envios" (click)="verDetalles(envio)" style="cursor: pointer;">
                  <td>
                    <strong class="hawb-text">{{ envio.hawb }}</strong>
                  </td>
                  <td>{{ envio.fecha_emision | date:'dd/MM/yyyy HH:mm' }}</td>
                  <td>
                    <span [class]="obtenerClaseEstado(envio.estado)">
                      {{ obtenerEstadoEnvio(envio.estado) }}
                    </span>
                  </td>
                  <td class="text-end">{{ envio.peso_total | number:'1.2-2' }} kg</td>
                  <td class="text-end">{{ envio.cantidad_total }}</td>
                  <td class="text-end">
                    <span class="costo-servicio">{{ envio.valor_total | currency:'USD':'symbol':'1.2-2' }}</span>
                  </td>
                  <td class="text-end">
                    <span class="costo-servicio">{{ envio.costo_servicio | currency:'USD':'symbol':'1.2-2' }}</span>
                  </td>
                  <td class="observaciones-cell">
                    <span *ngIf="envio.observaciones" class="observaciones-text" [title]="envio.observaciones">
                      {{ envio.observaciones.length > 50 ? (envio.observaciones.substring(0, 50) + '...') : envio.observaciones }}
                    </span>
                    <span *ngIf="!envio.observaciones" class="text-muted">-</span>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal de Detalles del Envío -->
  <app-envio-detail-modal
    [envioId]="selectedEnvioId"
    [show]="showDetailModal"
    (close)="cerrarModal()"
  ></app-envio-detail-modal>
</div>
