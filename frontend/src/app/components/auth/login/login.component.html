<div class="auth-page">
  <div class="auth-pattern layer-one"></div>
  <div class="auth-pattern layer-two"></div>
  <div class="auth-shell">
    <section class="info-column">
      <div class="brand-card">
        <div class="logo">
          <i class="fas fa-shipping-fast"></i>
          <div>
            <p class="eyebrow">Universal Box</p>
            <h1>Impulsa tus envíos internacionales</h1>
          </div>
        </div>
        <p class="subtitle">
          Gestiona los envíos, búsquedas, seguimiento, cupos y más desde un mismo sistema.
        </p>
      </div>


      <ul class="benefits">
        <li>
          <i class="fas fa-check-circle"></i>
          Seguridad basada en roles y paneles inteligentes.
        </li>
        <li>
          <i class="fas fa-check-circle"></i>
          Búsquedas semánticas, trazabilidad y control de cupos. Acceso a mapas y reportes.
        </li>
        <li>
          <i class="fas fa-check-circle"></i>
          Integración con mapa de compradores y reportes de IA.
        </li>
      </ul>

      <div class="cta-group">
        <a routerLink="/register" class="btn btn-light btn-ghost">
          <i class="fas fa-user-plus"></i>
          Crear cuenta
        </a>
      </div>
    </section>

    <section class="form-column">
      <div class="glass-card">
        <ng-container *ngIf="!showResetPassword; else resetTemplate">
          <header class="form-header">
            <div>
              <p class="eyebrow">Acceso seguro</p>
              <h2>Inicia sesión</h2>
              <p class="helper-text">
                Ingresa con tu usuario y contraseña asignados
              </p>
            </div>
          </header>

          <form [formGroup]="loginForm" (ngSubmit)="onSubmit()" class="form-fields">
            <div class="input-field" [class.error]="loginForm.get('username')?.invalid && loginForm.get('username')?.touched">
              <label for="username">Usuario</label>
              <div class="field-control">
                <i class="fas fa-user"></i>
                <input
                  id="username"
                  type="text"
                  formControlName="username"
                  placeholder="Ej. admin.ubapp"
                >
              </div>
              <small *ngIf="loginForm.get('username')?.invalid && loginForm.get('username')?.touched">
                {{ getErrorMessage('username') }}
              </small>
            </div>

            <div class="input-field" [class.error]="loginForm.get('password')?.invalid && loginForm.get('password')?.touched">
              <label for="password">Contraseña</label>
              <div class="field-control password-field">
                <i class="fas fa-lock"></i>
                <input
                  [type]="hidePassword ? 'password' : 'text'"
                  id="password"
                  formControlName="password"
                  placeholder="Ingresa tu contraseña"
                >
                <button type="button" class="password-toggle" (click)="hidePassword = !hidePassword">
                  <i class="fas" [class.fa-eye]="!hidePassword" [class.fa-eye-slash]="hidePassword"></i>
                </button>
              </div>
              <small *ngIf="loginForm.get('password')?.invalid && loginForm.get('password')?.touched">
                {{ getErrorMessage('password') }}
              </small>
            </div>

            <button type="submit" class="btn btn-primary submit-btn" [disabled]="!loginForm.valid || loading">
              <i class="fas fa-spinner fa-spin" *ngIf="loading"></i>
              <span *ngIf="!loading">Ingresar</span>
              <span *ngIf="loading">Validando acceso...</span>
            </button>

            <button type="button" class="link-button reset-password-link" (click)="toggleResetPassword()">
              <i class="fas fa-key"></i>
              ¿Olvidaste tu contraseña?
            </button>

            <div class="form-footer">
              <a routerLink="/informacion" class="btn btn-secondary btn-home">
                <i class="fas fa-home"></i>
                Volver al inicio
              </a>
            </div>
          </form>

          <div class="alert alert-error" *ngIf="errorMessage">
            <i class="fas fa-exclamation-triangle"></i>
            {{ errorMessage }}
          </div>

        </ng-container>

        <ng-template #resetTemplate>
          <header class="form-header">
            <div>
              <p class="eyebrow">Soporte inmediato</p>
              <h2>Recuperar contraseña</h2>
              <p class="helper-text">
                Ingresa el correo asociado a tu cuenta. Te enviaremos instrucciones para restablecer tu acceso.
              </p>
            </div>
            <button type="button" class="link-button" (click)="toggleResetPassword()">
              <i class="fas fa-arrow-left"></i>
              Volver al inicio de sesión
            </button>
          </header>

          <form [formGroup]="resetForm" (ngSubmit)="onResetPassword()" class="form-fields">
            <div class="input-field" [class.error]="(resetForm.get('email')?.invalid && resetForm.get('email')?.touched) || (!emailExists && resetForm.get('email')?.valid && resetForm.get('email')?.value)">
              <label for="resetEmail">Correo electrónico</label>
              <div class="field-control">
                <i class="fas fa-envelope"></i>
                <input
                  id="resetEmail"
                  type="email"
                  formControlName="email"
                  placeholder="correo@empresa.com"
                >
                <span class="email-status" *ngIf="resetForm.get('email')?.value && resetForm.get('email')?.valid && !checkingEmail">
                  <i class="fas" [class.fa-check-circle]="emailExists" [class.fa-times-circle]="!emailExists"></i>
                </span>
                <span class="email-status checking" *ngIf="checkingEmail">
                  <i class="fas fa-spinner fa-spin"></i>
                </span>
              </div>
              <small *ngIf="resetForm.get('email')?.invalid && resetForm.get('email')?.touched">
                {{ getResetErrorMessage() }}
              </small>
              <small class="email-verify-message" *ngIf="resetForm.get('email')?.valid && resetForm.get('email')?.value && !checkingEmail">
                <span *ngIf="emailExists" class="text-success">
                  <i class="fas fa-check-circle"></i>
                  Correo verificado en el sistema
                </span>
                <span *ngIf="!emailExists" class="text-error">
                  <i class="fas fa-times-circle"></i>
                  Este correo no está registrado
                </span>
              </small>
            </div>

            <button type="submit" class="btn btn-primary submit-btn" [disabled]="!resetForm.valid || loadingReset || !emailExists || checkingEmail">
              <i class="fas fa-spinner fa-spin" *ngIf="loadingReset"></i>
              <span *ngIf="!loadingReset">Enviar instrucciones</span>
              <span *ngIf="loadingReset">Enviando...</span>
            </button>
          </form>

          <div class="alert alert-success" *ngIf="resetSuccess">
            <i class="fas fa-check-circle"></i>
            Se ha enviado un correo con los pasos para restablecer tu contraseña.
          </div>

          <div class="alert alert-error" *ngIf="resetError">
            <i class="fas fa-exclamation-triangle"></i>
            {{ resetError }}
          </div>
        </ng-template>
      </div>
    </section>
  </div>
</div>
